<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <form>
            <div class="form-row">
                <div class="form-group col-md-3">
                    <label for="inputStartDate">Start Date</label>
                    <input type="datetime-local" class="form-control" id="startDate" required>
                </div>
                <div class="form-group col-md-3">
                    <label for="inputEndDate">End Date</label>
                    <input type="datetime-local" class="form-control" id="endDate" required>
                </div>
                <div class="form-group col-md-1"">
                    <button type=" button" class="btn btn-primary mt-4" id='btnConvert'>Convert</button>
                </div>
            </div>
        </form>
        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th>Time Zone</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                </tr>
            </thead>
            <tbody>
                <tr id='jp'></tr>
                <tr id='eu'></tr>
                <tr id='us'> </tr>
            </tbody>
        </table>
    </div>
    <script src=" https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.25.3/moment.min.js" crossorigin="anonymous">
    </script>
    <script src="https://momentjs.com/downloads/moment-timezone-with-data-10-year-range.js"
        crossorigin="anonymous"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            convert();
            btnConvert.addEventListener('click', function () {
                return convert();
            });
        });
        function initial() {
            const params = new URLSearchParams(window.location.search)
            if (params.has('start')) {
                document.getElementById('startDate').value = moment.unix(params.get('start')).format(moment.HTML5_FMT.DATETIME_LOCAL);
            } else {
                document.getElementById('startDate').value = moment().format(moment.HTML5_FMT.DATETIME_LOCAL);
            }
            if (params.has('end')) {
                document.getElementById('endDate').value = moment.unix(params.get('end')).format(moment.HTML5_FMT.DATETIME_LOCAL);
            } else {
                document.getElementById('endDate').value = moment().format(moment.HTML5_FMT.DATETIME_LOCAL);
            }
        }
        function convert() {
            initial();
            const startLocalTime = document.getElementById('startDate').value;
            const endLocalTIme = document.getElementById('endDate').value;

            setQueryString(startLocalTime, endLocalTIme);
            updateConverData(startLocalTime, endLocalTIme);
        }

        function setQueryString(startLocalTime, endLocalTIme) {
            const params = new URLSearchParams(location.search);
            params.set('start', moment(startLocalTime).unix());
            params.set('end', moment(startLocalTime).unix());
            params.toString();
            window.history.replaceState({}, '', `${location.pathname}?${params.toString()}`);
        }

        function updateConverData(startLocalTime, endLocalTIme) {
            document.getElementById('jp').innerHTML = `<th scope="row">Asia/Tokyo</th><td>${moment(startLocalTime).tz("Asia/Tokyo")}</td><td>${moment(endLocalTIme).tz("Asia/Tokyo")}</td>`;
            document.getElementById('eu').innerHTML = `<th scope="row">Europe/Luxembourg</th><td>${moment(startLocalTime).tz("Europe/Luxembourg")}</td><td>${moment(endLocalTIme).tz("Europe/Luxembourg")}</td>`;
            document.getElementById('us').innerHTML = `<th scope="row">America/Los_Angeles</th><td>${moment(startLocalTime).tz("America/Los_Angeles")}</td><td>${moment(endLocalTIme).tz("America/Los_Angeles")}</td>`;
        }
    </script>
</body>

</html>